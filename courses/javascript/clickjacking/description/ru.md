## Атака "ClickJacking"

Кликджекинг (англ. Clickjacking) — механизм обмана пользователей интернета, при котором злоумышленник может получить доступ к конфиденциальной информации пользователя, заманив его на внешне безобидную страницу. Принцип основан на том, что поверх видимой страницы располагается невидимый слой, в который и загружается нужная злоумышленнику страница в айфрейме, при этом элемент управления (например, кнопка или ссылка), необходимый для осуществления требуемого действия, совмещается с видимой ссылкой или кнопкой, нажатие на которую ожидается от пользователя. Возможны различные применения технологии — от подписки на ресурс в социальной сети до кражи чувствительной информации и совершения покупок в интернет-магазинах за чужой счёт.

### Защитные меры

**_Текущий подход_** подразумевает добавление во все HTTP-ответы «с вёрсткой» заголовок ``X-Frame-Options: DENY`` или ``X-Frame-Options: SAMEORIGIN``.

В спецификации Content Security Policy [появилась](https://developer.mozilla.org/en-US/docs/Web/Security/CSP/CSP_policy_directives#frame-ancestors) более удобная директива frame-ancestors позволяющая задать список доменов которым разрешено открывать ресурс во фреймах. Мы **_рекомендуем_** использовать CSP на ваших ресурсах не только для защиты от Clickjacking'а;-)

Если в сервисе необходима возможность фреймования из различных доменов, то рекомендуем сделать защиту на основе postMessage. Загружаемый во фрейме документ в самом начале «пингует» основной документ, проверяет хост и, если он попадает в список разрешенных, грузит основное содержимое. 

Альтернативный вариант — выставление заголовка `X-Frame-Options` на основе значения реферера. Но проверять надо именно по алгоритму: если реферер есть и равен какому-то из списка, то не показываем `X-Frame-Options`. То есть по умолчанию блокируем фреймование:
```nginx
if ($http_referer !~ "^https?://([^/]+\.)?website\.com/"){
    add_header X-Frame-Options SAMEORIGIN always;
}
```


### Задание

Данный код уязвим к атаке Clickjacking. Добавьте заголовок ``X-Frame-Options`` для защиты от Clickjacking.

### Дополнительная информация

* https://owasp.org/www-community/attacks/Clickjacking
* https://learn.javascript.ru/clickjacking
