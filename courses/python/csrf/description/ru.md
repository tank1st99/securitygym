## Атака "Подделка межсайтовых запросов"

CSRF (Сross Site Request Forgery, Подделка межсайтовых запросов) — вид атак на посетителей веб-сайтов, использующий недостатки протокола HTTP. Если жертва заходит на сайт, созданный злоумышленником, от её лица тайно отправляется запрос на другой сервер (например, на сервер платёжной системы), осуществляющий некую вредоносную операцию (например, перевод денег на счёт злоумышленника). Для осуществления данной атаки, жертва должна быть авторизована на том сервере, на который отправляется запрос, и этот запрос не должен требовать какого-либо подтверждения со стороны пользователя, который не может быть проигнорирован или подделан атакующим скриптом.

Чтобы предотвратить атаку все запросы на изменение состояния данных должны быть подписаны специальным токеном.

Важно помнить, что этой атаке могут быть подвержены также и внутренние (недоступные напрямую злоумышленнику) сервисы/панели администрирования, поэтому важно не забыть про их защиту.

![Пример CSRF-атаки](/api/courses/images/python/csrf/bank_csrf.png)

### Защитные меры

Подписывание запроса специальным токеном. 

Чтобы включить защиту от CSRF-атак во Flask-приложениях, подключи расширение CSRFProtect.

```python
from flask_wtf.csrf import CSRFProtect

csrf = CSRFProtect(app)
```

Для того, чтобы положить токен в шаблон, можно воспользоваться следующим кодом:

```html
<form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
</form>
```

### Задание

Функциональность перевода средств в приведенном коде уязвима к атаке CSRF. Исправь уязвимость, не меняя поведение программы.

### Дополнительная информация
* http://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29